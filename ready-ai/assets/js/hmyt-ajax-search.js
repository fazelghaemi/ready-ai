jQuery(document).ready(function(e){let t,a=hmytAjaxSearch.min_chars||3,s=hmytAjaxSearch.delay||300,i=hmytAjaxSearch.enable_overlay||!1,n="hmyt_recent_searches",r=null;function h(e){let t=e.find(".hmyt-ajax-search-results");t.html(r),c(t),t.show()}function c(t){let a=t.find(".hmyt-recent-searches-list");if(!a.length)return;let s=JSON.parse(localStorage.getItem(n))||[];s.length>0?(a.empty(),s.forEach(t=>{let s=e('<span class="hmyt-suggestion-item"></span>').text(t).append('<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M15 19.9201L8.47997 13.4001C7.70997 12.6301 7.70997 11.3701 8.47997 10.6001L15 4.08008" stroke="currentcolor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> </svg>');a.append(s)}),t.find(".hmyt-recent-searches").show()):t.find(".hmyt-recent-searches").hide()}e(".hmyt-ajax-search-wrapper").each(function(){let t=e(this),a=t.find(".hmyt-ajax-search-results");r||(r=a.html()),c(a),a.hide()}),e(".hmyt-ajax-search-input").on("focus",function(){i&&e("body").addClass("hmyt-search-overlay-active");let t=e(this).closest(".hmyt-ajax-search-wrapper"),s=e(this).val();s.length<a?h(t):t.find(".hmyt-ajax-search-results").show()}),e(".hmyt-ajax-search-input").on("keyup input",function(){let i=e(this),r=i.val(),c=i.closest(".hmyt-ajax-search-wrapper"),l=c.find(".hmyt-ajax-search-results"),o=c.find(".hmyt-ajax-search-submit"),m=c.find(".hmyt-ajax-search-clear");r.length>0?(o.hide(),m.show()):(o.show(),m.hide()),clearTimeout(t),r.length>=a?(l.find(".hmyt-result-title").length||l.html('<div class="hmyt-search-loader"><svg width="44" height="44" viewBox="0 0 44 44" stroke="#2d3748"><g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g></svg></div>').show(),t=setTimeout(function(){e.ajax({url:hmytAjaxSearch.ajax_url,type:"POST",data:{action:"hmyt_ajax_search",nonce:hmytAjaxSearch.nonce,query:r},success:function(e){if(e.success){let t=e.data.html;if(e.data.suggestion&&l.find(".hmyt-no-results")){let a=`
                                    <div class="hmyt-did-you-mean">
                                        آیا منظور شما 
                                        <span class="hmyt-did-you-mean-suggestion">${e.data.suggestion}</span>
                                        بود؟
                                    </div>`;t=a+t}if(l.html(t).show(),!l.find(".hmyt-no-results").length){var s;let i;s=r,(i=(i=JSON.parse(localStorage.getItem(n))||[]).filter(e=>e!==s)).unshift(s),i.length>5&&i.pop(),localStorage.setItem(n,JSON.stringify(i))}}else l.html('<div class="hmyt-no-results">خطایی رخ داد.</div>').show()}})},s)):h(c)}),e(document).on("click",".hmyt-suggestion-item",function(){let t=e(this).clone().children().remove().end().text().trim(),a=e(this).closest(".hmyt-ajax-search-wrapper"),s=a.find(".hmyt-ajax-search-input");s.val(t).focus().trigger("keyup")}),e(document).on("click",".hmyt-ajax-search-clear",function(t){t.preventDefault();let a=e(this).closest(".hmyt-ajax-search-wrapper"),s=a.find(".hmyt-ajax-search-input");s.val("").focus(),s.trigger("keyup")}),e(document).on("click",".hmyt-reset-recent",function(){localStorage.removeItem(n);let t=e(this).closest(".hmyt-ajax-search-wrapper");c(t.find(".hmyt-ajax-search-results"))}),e(document).on("click",function(t){!e(t.target).closest(".hmyt-ajax-search-wrapper").length&&(e(".hmyt-ajax-search-results").hide(),i&&e("body").removeClass("hmyt-search-overlay-active"))}),e(document).on("click",".hmyt-did-you-mean-suggestion",function(){let t=e(this).text(),a=e(this).closest(".hmyt-ajax-search-wrapper"),s=a.find(".hmyt-ajax-search-input");s.val(t).focus().trigger("keyup")})});