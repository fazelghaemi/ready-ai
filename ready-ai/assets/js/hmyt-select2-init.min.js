// developed by web-premium.ir
jQuery(document).ready(function(e){e(".hmyt-user-select").select2({placeholder:"جستجو و انتخاب کاربر...",allowClear:!0,width:"100%",ajax:{url:hmyt_affiliate_vars.ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"hmyt_search_users",search:e.term}},processResults:function(e){return{results:e}},cache:!0},minimumInputLength:2,templateResult:function a(t){return t.loading?t.text:e('<div class="select2-user-result" style="font-family: \'Estedad-FD\', sans-serif;"><span class="user-name">'+t.display_name+'</span><span class="user-login">('+t.user_login+")</span></div>")},templateSelection:function e(a){return a.display_name||a.text}}),e(".hmyt-bank-select").select2({placeholder:"انتخاب بانک...",allowClear:!0,width:"100%"}),e(".hmyt-user-select").on("change",function(){let t=e(this).val(),n=e(this),s=n.closest("form"),l=s.find("#user_balance, #hmyt-create-user-balance"),r=s.find("#hmyt-create-user-bank-info"),o=s.find('input[name="settle_amount"]');l.html(""),r.html(""),t?fetch(hmyt_affiliate_vars.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=hmyt_get_user_info&user_id="+t}).then(e=>e.json()).then(e=>{e.success?(l.length&&l.html("موجودی فعلی: "+a(e.data.balance.toString())+" "+hmyt_affiliate_vars.currency_symbol),r.length&&(e.data.bank_info&&e.data.bank_info.card&&e.data.bank_info.sheba&&e.data.bank_info.bank?r.html("اطلاعات بانکی: "+e.data.bank_info.name+" | "+e.data.bank_info.card+" | IR"+e.data.bank_info.sheba+" | "+e.data.bank_info.bank):r.html('<span style="color: red;">اطلاعات بانکی ثبت نشده است.</span>')),o.length&&o.val(a(e.data.balance.toString()))):toast.error(e.data?.message||"خطا در دریافت اطلاعات کاربر.")}).catch(e=>{console.error("خطا در دریافت اطلاعات کاربر:",e),toast.error("خطا در ارتباط با سرور.")}):o.val("")});function a(e){let a=e.toString().replace(/[^0-9.]/g,"");if(!a)return"";let t=a.split("."),n=parseInt(t[0]).toLocaleString("en-US",{useGrouping:!0}),s=t[1]?"."+t[1]:"";return n+s}});