// developed by web-premium.ir
jQuery(document).ready(function(t){function e(t,e="block"){t&&t.length&&("none"===t.css("display")&&t.css("display",e),requestAnimationFrame(function(){setTimeout(function(){t.addClass("visible")},20)}))}function i(){-1!==window.location.href.indexOf("edit.php?post_type=product&page=product-reviews")&&t('tr.comment, tr[id^="comment-"]').each(function(){var e=t(this),i=e.attr("id")?e.attr("id").replace("comment-",""):"",s="",a=e.find('.column-comment a[href*="post="], .column-response a[href*="post="], .column-product a[href*="post="]').attr("href");if(a){var n=a.match(/post=(\d+)/);n&&(s=n[1])}if(s||(s=e.find('a[href*="post_type=product"]').attr("href")?.match(/post=(\d+)/)?.[1]||""),i&&!(e.find(".hmyt-ai-generate-comment-response-btn").length>0)){var o=t('<span class="ai_response"> <button type="button" class="button button-primary hmyt-ai-generate-comment-response-btn" data-comment-id="'+i+'" data-post-id="'+(s||"")+'" style="background-color: #2d3748; color: #fff; border: none; border-radius: 3px; cursor: pointer; font-size: 13px; margin: 0 5px; padding: 3px 8px;">پاسخ با هوش مصنوعی</button></span>');e.find(".row-actions").append(o)}})}t(".satisfaction-text .percentage").each(function(){t(this).text(function t(e){let i=["۰","۱","۲","۳","۴","۵","۶","۷","۸","۹"];return e.toString().replace(/\d/g,function(t){return i[t]})}(t(this).text()))}),t(document).ready(function(){t(".hmyt-ai-skeleton-wrapper").each(function(){var i=t(this),s=i.find(".hmyt-ai-review-summary");i.find(".hmyt-ai-skeleton-header, .hmyt-ai-skeleton-satisfaction, .hmyt-ai-skeleton-content, .hmyt-ai-skeleton-pros-cons, .hmyt-ai-skeleton-disclaimer, .hmyt-ai-skeleton-feedback, .hmyt-ai-skeleton-footer").show(),setTimeout(function(){if(i.find(".hmyt-ai-skeleton-header, .hmyt-ai-skeleton-satisfaction, .hmyt-ai-skeleton-content, .hmyt-ai-skeleton-pros-cons, .hmyt-ai-skeleton-disclaimer, .hmyt-ai-skeleton-feedback, .hmyt-ai-skeleton-footer").hide(),s.removeClass("hidden").addClass("visible"),s.length&&!s.hasClass("has-animated")){s.addClass("has-animated");var a=s.find(".summary-text"),n=s.data("original-text")||a.text().trim();if(s.data("original-text")||s.data("original-text",n),n.length>0){n=n.replace(/\n/g,"<br />");var o,r,c,m=a[0].scrollHeight||100,d=10;let l;a.html("").css("max-height",m+"px"),o=a,r=n.replace(/<br \/>/g,"\n"),c=function(){setTimeout(function(){var i=s.find(".pros-cons-container");if(i.length){e(i,"flex");var a=i.length?200:0;s.find(".pro-item, .con-item").each(function(i){var s=t(this);setTimeout(function(){e(s,"inline-flex")},a+100*i+50)})}var n=300;i.length&&s.find(".pro-item").length>0&&(n=100*s.find(".pro-item").length+200),setTimeout(function(){e(s.find(".disclaimer"),"block"),setTimeout(function(){e(s.find(".feedback-container"),"flex")},300)},n)},300)},l=0,o.html(""),!function t(){l<r.length?(o.append(r.charAt(l)),l++,setTimeout(t,10)):c&&c()}()}else{a.css("max-height","0px");var p=s.find(".pros-cons-container");p.length&&(e(p,"flex"),s.find(".pro-item, .con-item").each(function(i){var s=t(this);setTimeout(function(){e(s,"inline-flex")},100*i+50)})),e(s.find(".disclaimer"),"block"),e(s.find(".feedback-container"),"flex")}}},2e3)})}),t(document).on("click",".feedback-btn",function(){var e=t(this),i=e.hasClass("like-btn")?"positive":"negative",s=e.data("product-id")||e.data("post-id"),a=e.closest(".feedback-container").data("summary-type"),n="",o={type:i,summary_type:a,security:hmyt_ai_vars.nonce};"reviews"===a||"description"===a?(n="save_feedback",o.product_id=s):("post_reviews"===a||"post_content"===a)&&(n="save_post_feedback",o.post_id=s),t.ajax({url:hmyt_ai_vars.ajax_url,type:"POST",data:{action:n,...o},success:function(t){t.success?(toast.success(t.data.message),e.addClass("active").siblings(".feedback-btn").removeClass("active")):(toast.error(t.data.message||"خطای ناشناخته در ثبت بازخورد."),t.data.redirect&&"yes"===hmyt_ai_vars.redirect_on_not_logged_in&&hmyt_ai_vars.login_url&&(toast.loading(hmyt_ai_vars.redirect_message),setTimeout(function(){window.location.href=hmyt_ai_vars.login_url},2e3)))},error:function(t,e,i){toast.error("خطا در ارتباط با سرور: "+i)}})}),t(document).on("click","#hmyt-ai-summarize-reviews-btn, #hmyt-ai-summarize-reviews-btn-initial",function(){!function e(i){var s=t(i),a=s.is("#hmyt-ai-summarize-reviews-btn-initial")?t("#hmyt-ai-reviews-spinner-initial"):t("#hmyt-ai-reviews-spinner"),n=t("#hmyt-ai-result"),o=s.data("product-id");if(!o){toast.error("خطا: شناسه محصول نامعتبر است.");return}s.prop("disabled",!0),a.addClass("is-active"),n.html("");var r=toast.loading("در حال تولید خلاصه دیدگاه‌ها...");t.post(hmyt_ai_vars.ajax_url,{action:"summarize_reviews",product_id:o,security:hmyt_ai_vars.nonce},function(e){if(toast.closeLoading(r),a.removeClass("is-active"),e.success){toast.success("خلاصه‌سازی دیدگاه‌ها با موفقیت انجام شد!"),n.html('<div class="notice notice-success is-dismissible"><p>'+e.data.message+"</p></div>"),t("#hmyt-ai-review-summary-editor").val(e.data.summary),null!==e.data.satisfaction?(t('input[name="hmyt_ai_satisfaction"]').val(e.data.satisfaction),t('input[name="hmyt_ai_satisfaction"]').closest(".hmyt-ai-satisfaction-container").length&&t('input[name="hmyt_ai_satisfaction"]').closest(".hmyt-ai-satisfaction-container").show(),e.data.satisfaction_icon&&t('input[name="hmyt_ai_satisfaction_icon"][value="'+e.data.satisfaction_icon+'"]').prop("checked",!0)):(t('input[name="hmyt_ai_satisfaction"]').val(""),t('input[name="hmyt_ai_satisfaction_icon"]').prop("checked",!1)),e.data.pros_cons?(t('textarea[name="hmyt_ai_pros"]').val(e.data.pros_cons.pros?e.data.pros_cons.pros.join("\n"):""),t('textarea[name="hmyt_ai_cons"]').val(e.data.pros_cons.cons?e.data.pros_cons.cons.join("\n"):""),t('textarea[name="hmyt_ai_pros"]').closest(".hmyt-ai-pros-cons-container").length&&t('textarea[name="hmyt_ai_pros"]').closest(".hmyt-ai-pros-cons-container").show()):(t('textarea[name="hmyt_ai_pros"]').val(""),t('textarea[name="hmyt_ai_cons"]').val(""));var i=new Date,o=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2)+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2);t("#hmyt-ai-review-last-updated-time").text(o),t("#hmyt-ai-review-summary-content-wrapper").show(),t(".hmyt-ai-reviews-actions").show(),t(".hmyt-ai-no-review-summary").hide()}else toast.error(e.data.message||e.data||"خطا در خلاصه‌سازی دیدگاه‌ها."),n.html('<div class="notice notice-error is-dismissible"><p>'+(e.data.message||e.data||"خطای ناشناخته")+"</p></div>");s.prop("disabled",!1)}).fail(function(t,e,i){toast.closeLoading(r),a.removeClass("is-active");var o="خطا در ارتباط با سرور: "+i;t.responseText&&(o+="<br>پاسخ سرور: "+t.responseText),toast.error(o),n.html('<div class="notice notice-error is-dismissible"><p>'+o+"</p></div>"),s.prop("disabled",!1)})}(this)}),t(document).on("click","#hmyt-ai-summarize-description-btn, #hmyt-ai-summarize-description-btn-initial",function(){!function e(i){var s=t(i),a=s.is("#hmyt-ai-summarize-description-btn-initial")?t("#hmyt-ai-description-spinner-initial"):t("#hmyt-ai-description-spinner"),n=t("#hmyt-ai-result"),o=s.data("product-id");if(!o){toast.error("خطا: شناسه محصول نامعتبر است.");return}s.prop("disabled",!0),a.addClass("is-active"),n.html("");var r=toast.loading("در حال تولید خلاصه توضیحات...");t.post(hmyt_ai_vars.ajax_url,{action:"summarize_description",product_id:o,security:hmyt_ai_vars.nonce},function(e){if(toast.closeLoading(r),a.removeClass("is-active"),e.success){toast.success("خلاصه‌سازی توضیحات با موفقیت انجام شد!"),n.html('<div class="notice notice-success is-dismissible"><p>'+e.data.message+"</p></div>"),t("#hmyt-ai-description-summary-editor").val(e.data.summary);var i=new Date,o=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2)+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2);t("#hmyt-ai-description-last-updated-time").text(o),t("#hmyt-ai-description-summary-content-wrapper").show(),t(".hmyt-ai-description-actions").show(),t(".hmyt-ai-no-description-summary").hide()}else toast.error(e.data.message||e.data||"خطا در خلاصه‌سازی توضیحات."),n.html('<div class="notice notice-error is-dismissible"><p>'+(e.data.message||e.data||"خطای ناشناخته")+"</p></div>");s.prop("disabled",!1)}).fail(function(t,e,i){toast.closeLoading(r),a.removeClass("is-active");var o="خطا در ارتباط با سرور: "+i;t.responseText&&(o+="<br>پاسخ سرور: "+t.responseText),toast.error(o),n.html('<div class="notice notice-error is-dismissible"><p>'+o+"</p></div>"),s.prop("disabled",!1)})}(this)}),t(document).on("click","#hmyt-ai-summarize-post-reviews-btn, #hmyt-ai-summarize-post-reviews-btn-initial",function(){!function e(i){var s=t(i),a=s.is("#hmyt-ai-summarize-post-reviews-btn-initial")?t("#hmyt-ai-post-reviews-spinner-initial"):t("#hmyt-ai-post-reviews-spinner"),n=t("#hmyt-ai-post-result"),o=s.data("post-id");if(!o){toast.error("خطا: شناسه پست نامعتبر است.");return}s.prop("disabled",!0),a.addClass("is-active"),n.html("");var r=toast.loading("در حال تولید خلاصه دیدگاه‌های پست...");t.post(hmyt_ai_vars.ajax_url,{action:"summarize_post_reviews",post_id:o,security:hmyt_ai_vars.nonce},function(e){if(toast.closeLoading(r),a.removeClass("is-active"),e.success){toast.success("خلاصه‌سازی دیدگاه‌های پست با موفقیت انجام شد!"),n.html('<div class="notice notice-success is-dismissible"><p>'+e.data.message+"</p></div>"),t("#hmyt-ai-post-review-summary-editor").val(e.data.summary);var i=new Date,o=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2)+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2);t("#hmyt-ai-post-review-last-updated-time").text(o),t("#hmyt-ai-post-review-summary-content-wrapper").show(),t(".hmyt-ai-reviews-actions").show(),t(".hmyt-ai-no-review-summary").hide()}else toast.error(e.data.message||e.data||"خطا در خلاصه‌سازی دیدگاه‌های پست."),n.html('<div class="notice notice-error is-dismissible"><p>'+(e.data.message||e.data||"خطای ناشناخته")+"</p></div>");s.prop("disabled",!1)}).fail(function(t,e,i){toast.closeLoading(r),a.removeClass("is-active");var o="خطا در ارتباط با سرور: "+i;t.responseText&&(o+="<br>پاسخ سرور: "+t.responseText),toast.error(o),n.html('<div class="notice notice-error is-dismissible"><p>'+o+"</p></div>"),s.prop("disabled",!1)})}(this)}),t(document).on("click","#hmyt-ai-summarize-post-content-btn, #hmyt-ai-summarize-post-content-btn-initial",function(){!function e(i){var s=t(i),a=s.is("#hmyt-ai-summarize-post-content-btn-initial")?t("#hmyt-ai-post-content-spinner-initial"):t("#hmyt-ai-post-content-spinner"),n=t("#hmyt-ai-post-result"),o=s.data("post-id");if(!o){toast.error("خطا: شناسه پست نامعتبر است.");return}s.prop("disabled",!0),a.addClass("is-active"),n.html("");var r=toast.loading("در حال تولید خلاصه متن پست...");t.post(hmyt_ai_vars.ajax_url,{action:"summarize_post_content",post_id:o,security:hmyt_ai_vars.nonce},function(e){if(toast.closeLoading(r),a.removeClass("is-active"),e.success){toast.success("خلاصه‌سازی متن پست با موفقیت انجام شد!"),n.html('<div class="notice notice-success is-dismissible"><p>'+e.data.message+"</p></div>"),t("#hmyt-ai-post-content-summary-editor").val(e.data.summary);var i=new Date,o=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2)+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2);t("#hmyt-ai-post-content-last-updated-time").text(o),t("#hmyt-ai-post-content-summary-content-wrapper").show(),t(".hmyt-ai-description-actions").show(),t(".hmyt-ai-no-description-summary").hide()}else toast.error(e.data.message||e.data||"خطا در خلاصه‌سازی متن پست."),n.html('<div class="notice notice-error is-dismissible"><p>'+(e.data.message||e.data||"خطای ناشناخته")+"</p></div>");s.prop("disabled",!1)}).fail(function(t,e,i){toast.closeLoading(r),a.removeClass("is-active");var o="خطا در ارتباط با سرور: "+i;t.responseText&&(o+="<br>پاسخ سرور: "+t.responseText),toast.error(o),n.html('<div class="notice notice-error is-dismissible"><p>'+o+"</p></div>"),s.prop("disabled",!1)})}(this)}),t(document).on("click","#hmyt-ai-delete-review-summary",function(){confirm("آیا مطمئن هستید که می‌خواهید خلاصه دیدگاه‌های این محصول را حذف کنید؟")&&(t("#hmyt-ai-review-summary-editor").val(""),t('input[name="hmyt_ai_satisfaction"]').val(""),t('input[name="hmyt_ai_satisfaction_icon"]').prop("checked",!1),t('textarea[name="hmyt_ai_pros"]').val(""),t('textarea[name="hmyt_ai_cons"]').val(""),t("#hmyt-ai-review-summary-content-wrapper").hide(),t(".hmyt-ai-reviews-actions").hide(),t(".hmyt-ai-no-review-summary").show(),t("#hmyt-ai-result").html(""),toast.success("خلاصه دیدگاه‌ها با موفقیت حذف شد."))}),t(document).on("click","#hmyt-ai-delete-description-summary",function(){confirm("آیا مطمئن هستید که می‌خواهید خلاصه توضیحات این محصول را حذف کنید؟")&&(t("#hmyt-ai-description-summary-editor").val(""),t("#hmyt-ai-description-summary-content-wrapper").hide(),t(".hmyt-ai-description-actions").hide(),t(".hmyt-ai-no-description-summary").show(),t("#hmyt-ai-result").html(""),toast.success("خلاصه توضیحات با موفقیت حذف شد."))}),t(document).on("click","#hmyt-ai-delete-post-review-summary",function(){confirm("آیا مطمئن هستید که می‌خواهید خلاصه دیدگاه‌های این پست را حذف کنید؟")&&(t("#hmyt-ai-post-review-summary-editor").val(""),t("#hmyt-ai-post-review-summary-content-wrapper").hide(),t(".hmyt-ai-reviews-actions").hide(),t(".hmyt-ai-no-review-summary").show(),t("#hmyt-ai-post-result").html(""),toast.success("خلاصه دیدگاه‌های پست با موفقیت حذف شد."))}),t(document).on("click","#hmyt-ai-delete-post-content-summary",function(){confirm("آیا مطمئن هستید که می‌خواهید خلاصه متن این پست را حذف کنید؟")&&(t("#hmyt-ai-post-content-summary-editor").val(""),t("#hmyt-ai-post-content-summary-content-wrapper").hide(),t(".hmyt-ai-description-actions").hide(),t(".hmyt-ai-no-description-summary").show(),t("#hmyt-ai-post-result").html(""),toast.success("خلاصه متن پست با موفقیت حذف شد."))}),t('input[name="hmyt_ai_override_global"]').on("change",function(){t(this).is(":checked")?t(".override-settings").show():t(".override-settings").hide()}),t('input[name="hmyt_ai_post_override_global"]').on("change",function(){t(this).is(":checked")?t(this).closest(".hmyt-ai-display-settings").find(".override-settings").show():t(this).closest(".hmyt-ai-display-settings").find(".override-settings").hide()}),i(),t(document).ajaxComplete(function(){i()}),t(document).on("click",".hmyt-ai-generate-comment-response-btn",function(){var e=t(this),i=e.data("comment-id"),s=e.closest("tr"),a=s.find('.comment-reply-link, a[href*="replyto-comment"], button[data-action="replyto"], .vim-r.comment-inline');a.length?(a.trigger("click"),setTimeout(function(){var a=s.nextAll("tr.inline-edit-row, tr.comment-inline").first().find('textarea[name="replycontent"], textarea#replycontent');if(!a.length){toast.error("خطا: فیلد پاسخ دیدگاه در ویرایش سریع یافت نشد."),e.prop("disabled",!1).css("opacity","1");return}e.prop("disabled",!0).css("opacity","0.7");var n=toast.loading(hmyt_ai_vars.generating_response_message);t.post(hmyt_ai_vars.ajax_url,{action:"hmyt_ai_generate_comment_response",comment_id:i,security:hmyt_ai_vars.nonce},function(t){toast.closeLoading(n),e.prop("disabled",!1).css("opacity","1"),t.success?(toast.success(t.data.message),a.val(t.data.response_text)):toast.error(t.data.message||"خطا در تولید پاسخ هوش مصنوعی.")}).fail(function(t,i,s){toast.closeLoading(n),e.prop("disabled",!1).css("opacity","1");var a="خطا در ارتباط با سرور: "+s;t.responseText&&(a+="<br>پاسخ سرور: "+t.responseText),toast.error(a)})},600),e.prop("disabled",!0).css("opacity","0.7")):(toast.error("خطا: دکمه پاسخ استاندارد برای این دیدگاه یافت نشد."),e.prop("disabled",!1).css("opacity","1"))}),t(".hmyt-ai-meta-box .nav-tab-wrapper a").on("click",function(e){e.preventDefault();var i=t(this).attr("href");t(this).addClass("nav-tab-active").siblings().removeClass("nav-tab-active"),t(i).addClass("active").siblings(".tab-content").removeClass("active")})});